# nmBot 2023 年 3 月功能更新

亲爱的用户，您期盼已久的 nmBot 功能更新现已推出。
本更新优化了群组管理员以匿名身份管理群组的体验。本更新还包含错误修复和稳定性提升。

## 2023 年 3 月 9 日 14:30
- 匿名管理员通过 nmBot 执行管理操作时，若该匿名管理员具有在所有匿名管理员中唯一的自定义头衔，nmBot 将识别他的权限来完成操作。
- 匿名管理员通过 nmBot 执行管理操作时，若所有匿名管理员均拥有所需权限，nmBot 将完成此操作。
- 匿名管理员在群组中通过按钮取消封禁成员时，管理员身份将显示为“匿名管理员”，并不再添加链接和 ID 记录。操作记录中记录的管理员身份不变。
- 匿名管理员启用“频道透视眼”后，在群组中通过发送指令封禁或取消封禁成员时，管理员身份将显示为频道身份或匿名管理员身份，并不再添加到匿名管理员身份的链接。操作记录中记录的管理员身份不变。
- 使用 /spam 指令封禁用户时，nmBot 将检索最近约 100 条消息的发送者，并删除其中由被封禁用户发送的消息。
- 使用 /spam 指令举报用户中，消息内容中的部分符号将被转义。
- 新入群用户被 nmBot 识别为骚扰用户并封禁、因群组拒绝新用户入群被封禁、因并非 Telegram 会员被封禁时，提示消息将在 120 秒后自动删除。
- nmBot “智能识别并删除骚扰消息”功能将不会对群组管理员、匿名管理员、群组绑定频道的消息执行操作。
- nmBot “智能识别并删除骚扰消息”功能删除消息后，若用户未被封禁，将新增“封禁用户”或“封禁频道”按钮，点击即可封禁用户或频道。
- 使用 /spam 指令封禁并举报用户或频道后，若“智能识别并删除骚扰消息”中“nmBot 反骚扰系统识别为广告的消息”选项设置为“关”，则设置将自动更改为“删除”。
- 使用“拒绝并举报骚扰 (管理员)”按钮拒绝用户入群后，将自动启用入群验证“自动拒绝骚扰用户入群”功能。
- 使用按钮解除禁言用户或频道后，新增“关闭”按钮。
- 优化了 nmBot 跨站脚本攻击与格式错误预防工具对文本内容的处理：该工具将根据文本的目标格式化方式处理文本内容。
- 使用 /ban, /unban, /block, /unblock, /kick, /spam, /d, /pin, /unpin, /sc, /lc, /vt, /cw, /wc, /dt, /pe, /id, /pm 指令后，使用“关闭”按钮删除消息时，特定情况下将同时删除发送的指令消息。
- 将 nmBot 语言设置为繁体中文时，发送 /banme 指令时获得的返回消息中的趣味内容支持以繁体中文显示。
- 发送 /banme 指令时获得的返回消息中的结果添加对多种语言的支持。
- /id 功能新增显示共享用户和共享对话消息类型。
- /id 功能支持显示媒体组 ID。
- /id 功能支持显示发送消息的匿名管理员的头衔和转发消息的头衔或发送者名称。
- /json 功能的返回消息显示为等宽。
- 频道验证功能无法获取订阅信息时，新增了相应的提示文本，提示管理员确认 nmBot 是否是频道管理员。
- nmBot 面板关键词回复编辑页面中，“从‘鲁小迅’导入”功能和相关说明已更名为“从‘鲁小迅’或‘無名’导入”。
- 通过 nmBot 面板编辑关键词回复时，“从‘鲁小迅’或‘無名’导入”新增对导入转发来源和“無名”拷贝图片消息的支持。
- 使用 /me 指令发送个人名片时，名片标题将显示为粗体文本。
- 为用户名片审核结果消息和举报处理结果消息新增了标题。
- 使用“群友互动”时，若发送的互动消息首个字符为斜杠或反斜杠，“群友互动”功能将不会触发。您可以在斜杠或反斜杠前加 $ 来触发。
- /start 指令的返回消息中，删除了打开 nmBot 帮助文档的指令提示，并新增了打开 nmBot 帮助文档的按钮。
- 用户入群时被 nmBot 识别为骚扰用户并封禁时，提示消息中“触犯规则”行不再显示为等宽效果。
- 在 nmBot 面板中，通过我的 > 关于 nmBot > 开放源代码许可打开开放源代码许可页面时，页面框架中将不再显示附加选项。
- nmBot 面板我的 > 关于 nmBot 页面中，版权信息中的年份现在显示为 2022-2023 年。
- 优化了 nmBot 入群验证 ID 的生成方式。
- 对 nmBot 内容本地化做出了如下调整和修复：
    - 简化了用户发送的消息被识别为骚扰消息时，提示消息的消息文本。
    - 简化了举报处理结果消息的文本内容。
    - 用户发送的消息被识别为骚扰消息时，提示消息中的“规则 ID”修改为“触犯规则”。
    - /id 功能的返回消息中，消息标题更改为“消息元数据”。
    - /id 功能的返回消息中，关于 /json 功能的提示文本修改为“发送 /json 指令获取消息的完整元数据”。
    - 优化了若群成员未曾在 nmBot 面板设置过名片，使用 /me 指令发送名片时相关提示信息的文本。
    - 使用简体中文和繁体中文时，自动删除消息设置中，“通过 bot 发送的消息”修改为“通过机器人发送的消息”。
    - 优化了使用简体中文和繁体中文时 nmBot 面板“自动删除以下类别的消息”提示文本的排版。
    - 修正了使用英文时，用户入群时被 nmBot 识别为骚扰用户并封禁时，提示消息中“Rules effected:”未区分单复数的问题。
    - 修复了使用繁体中文时，“智能识别并删除骚扰消息”的提示消息、含秒时间的消息中可能存在排版错误的问题。
    - 修复了使用繁体中文时，/warn 指令的部分报错信息存在排版错误的问题。
    - 修正了使用繁体中文时，“在 nmBot 面板再領 10+ 積分”文本显示不正确的问题。
    - 修复了 nmBot 和 nmBot 面板中，操作记录中部分字段缺少本地化文本的问题。
    - 修正了 nmBot 面板关键词回复编辑页面中，“姓和名的匹配规则”文本和上下文的标点符号使用不一致的问题。
- 优化了 nmBot 面板“自动删除以下类别的消息”提示文本中链接的特定触发效果。
- 修复了群组管理员通过“封禁并举报骚扰”按钮封禁入群用户时，验证消息未正常更新的问题。
- 修复了可以通过 /ban、/block、/spam 等指令对匿名管理员执行操作的问题。
- 修复了特定情况下 nmBot 在频道中发送的操作记录显示链接预览的问题。
- 修复了若在群组未设置过关键词回复时发送 /lr 指令获取关键词回复列表，特定情况下出现程序错误的问题。
- 修复了生成用户名称失败时，部分消息可能会发送失败的问题。
- 修复了以频道身份触发关键词回复时，频道名称显示为 Channel 或 Group 的问题。
- 修复了使用 /warn 指令对频道身份操作时，警告用户显示为 Channel，ID 书签显示为用户身份的问题。
- 修复了使用 /warn 指令对频道身份操作时，操作记录中记录用户为 Channel 的问题。
- 修复了特定情况下 /id 功能无法正确发送消息的问题。
- 修复了特定情况下，使用 /spam 指令举报用户时，未正确识别转发来源的问题。
- 修复了在 nmBot 面板群组设置中使用“停用 nmBot 并删除使用数据”后，部分使用数据未被清除的问题。
- 修复了在 nmBot 面板群组设置中修改“智能识别并删除骚扰消息”某一类别设置后，页面上其他类别的显示状态错误的问题。
- 修复了在 nmBot 面板导入来自“鲁小迅”的关键词回复时，若在特定情况下取消导入，页面可能提示错误的问题。
- 修复了 2023 年 1 月更新后，“欢乐复读”功能在两位群成员复读 nmBot 通过 nmartChat 发送的消息时表现不正常的问题；修复后相关功能效果与 2022 年 10 月 8 日 22:55 更新后的效果一致。
- 修复了 2023 年 1 月更新后，若群成员未曾在 nmBot 面板设置过名片，使用 /me 指令发送名片时，相关提示信息错误显示为“你当前的名片是空的”的问题。
- 修复了作为 Telegram Web App 打开时，nmBot 面板语言设置页面、开放源代码页面未正确应用深色模式的问题。
- 修复了深色模式下，在特定浏览器中，nmBot 面板中部分下拉选项中的文本显示为黑色的问题。
- 修复了深色模式下，nmBot 面板中操作记录详情页面中的文本显示为黑色的问题。
- 修复了处理骚扰举报时，举报文件未发送的问题。