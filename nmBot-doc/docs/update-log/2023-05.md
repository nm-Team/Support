# nmBot 2023 年 5 月功能更新

亲爱的用户，您期盼已久的 nmBot 功能更新现已推出。  
本更新推出了“指令映射”功能，允许用户使用自定义的指令文本触发常用的 nmBot 指令。本更新还包含错误修复和稳定性提升。

## 2023 年 5 月 18 日 21:30
nmBot 版本号：23.5.3

- 优化了按消息类别自动删除消息功能的内部实现，以尝试解决特定情况下 nmBot 回复部分群组消息时缓慢的问题。

## 2023 年 5 月 16 日 23:58
nmBot 版本号：23.5.2

- nmBot 在 Telegram 中显示的指令列表中新增 /whatis, /mapping 和 /dc 指令。
- 我们正在调查特定情况下 nmBot 回复部分群组消息时缓慢的问题。为进一步排查问题，此版本中新增了部分 nmBot 运行日志。

## 2023 年 5 月 13 日 01:23
nmBot 版本号：23.5.1

- 修复了特定情况下，入群验证超时后，入群验证提示消息未在一段时间后自动删除的问题。

## 2023 年 5 月 11 日 13:20

### 指令映射
- 你现在可以使用 /mapping 指令设置自定义指令映射。设置指令映射后，你可以将你设置的自定义指令代替官方指令使用。
- 你可以使用 /unmapping 指令来取消指令映射。
- 使用 /whatis 指令查询指令信息时，支持使用你自定义的指令来查询。
- 使用 /whatis 指令查询指令信息时，返回的指令信息中现在将显示你自定义的指令。

### 设置对话标题
- 群组管理员现在可以通过发送 /st (/settitle) 指令快速设置对话标题。

### 深度适配网页 App
- nmBot 面板可以通过 Telegram 直达链接 https://t.me/nmnmfunbot/panel 打开。
- 全新设计了 /panel 指令，在保留通过浏览器打开 nmBot 面板能力的基础上，新增通过 Telegram 直达链接直接在对话中作为网页 App 启动 nmBot 面板的能力。

### 更多亮点
- 新增数据中心查询功能：你可以使用 /dc (/datacenter) 指令查询自己、回复的用户、回复消息中的文件、回复消息的转发来源用户和在参数中提供的用户所在的 Telegram 数据中心。
- nmBot 自动拒绝骚扰用户入群功能和举报骚扰功能现在支持识别入群用户的个人签名。
- /id 功能支持显示骰子类消息的类型和骰子 (🎲)、打靶 (🎯)、保龄球 (🎳)、投篮 (🏀) 和射门 (⚽️) 消息的结果。

### 其他更新和修复
- 为 nmBot 面板推出了新的页面加载中视图。
- nmBot 面板“管理”页面中，对话列表中的对话现在可以通过浏览器原生支持的方式（例如长按或按住 Ctrl 键并点击）在新浏览器选项卡中打开。
- 本次更新后，群组管理员权限变化时，将自动在 nmBot 面板中注册或取消注册。
- 为新版“同频气氛组”体验新增了 10 秒的触发限制。
- nmBot 群组 /config 菜单入群验证设置集描述文本中新增“如果“频道验证”在您的群组中不工作”疑难解答文档链接。
- 用户触发的“你有一个未完成的入群验证，请在完成验证后再发送消息”提示消息现在将在发送 20 秒后自动删除。
- 用户发送的消息被识别为骚扰消息后，相关消息将不再能触发“欢乐复读”功能。
- 若关键词回复中的禁言时间被设为 30 秒以内或 366 天以上，该设置将对触发关键词回复的频道身份生效。（此前版本中，无论关键词回复中的禁言时间设置如何，该项设置均不对频道身份生效。）
- 在 nmBot 面板“关键词回复”设置页面“关键词”设置项的说明文本中添加了进一步了解正则表达式的链接。
- 在 nmBot 面板“关键词回复”设置页面“禁言用户”设置项的说明文本中添加了如下说明：对发言的频道身份，此设置仅在禁言时间被视为永久时生效。
- 若频道身份发送的消息触发的关键词回复设置的禁言时间并非被视为永久，回复消息中将不再添加关于禁言的说明。
- 群组管理员使用关键词回复发送的回复消息中的按钮取消禁言用户或频道后，关键词回复中的文本内容将不再被编辑。
- 操作记录新增对以下操作的支持：
    - 通过 /st 指令更改群组标题。
- nmartChat 新增部分内置返回消息。
- 调整了 nmartChat 部分内置返回消息的触发概率。
- 调整了 nmBot 面板入群验证设置页面部分选项的排序和分类。
- 调整了 nmBot 面板部分页面中返回按钮获得键盘焦点时的提示框显示效果。
- 调整了 nmBot 面板页面副标题的字体大小。
- 对 nmBot 内容本地化做出了如下调整和修复：
    - 修复了使用英文时，/whatis 指令的返回消息中，“User Permission Required”未正确区分单复数的问题。
    - 修复了使用英文时，/whatis 指令的返回消息中，“Operating via Channel”前存在一处多余空格的问题。
- 修复了 nmBot 面板部分页面错误显示标题栏，且部分功能无法正常使用的问题。
- 修复了 nmBot 发送的骚扰消息操作提示中，若消息发送者为频道身份，则相应链接错误的问题。
- 修复了入群验证部分返回消息自动删除时间错误的问题。
- 修复了入群验证失败或被管理员拒绝时，相应群组内消息未正常更新和私信消息未正常发送的问题。
- 修复了在私信中使用 /id 指令时，返回消息中异常显示对话标题的问题。
- 修复了在私信中使用 /id 指令时，返回消息的标题插入的超链接无效的问题：修复后在私信中该位置不再显示超链接。
- 修复了特定情况下锁定模式执行效果与预期不符的问题。
- 修复了特定情况下，若 nmartChat 组织完消息前源消息被删除，nmartChat 发送返回消息失败的问题。
- 修复了特定情况下，用户被 nmBot 错误注册群组配置的问题。
- 修复了未在 nmBot 面板修改显示语言时，语言设置页面不显示正在使用的语言的问题。

